# LTS-OSM - Calculating Level of Traffic Stress using Open Street Map Data

This code calculates cycling [Level of Traffic Stress](https://peterfurth.sites.northeastern.edu/level-of-traffic-stress/) for all road and path segments in a region using data from Open Street Map.

## Background

This code is adapted from [Bike Ottawa's LTS code](https://github.com/BikeOttawa/stressmodel), modified to include Level of Traffic Stress for intersections. 
This is code is forked and adapted from [Madeliene Bonsma-Fisher's LTS_OSM](https://github.com/mbonsma/LTS-OSM) implementation, it has been adapted to be have a more generic and adaptable use, majority if not all of the logic remains intact from her implementation.

## Usage

1. Setup a python virtual environment
```shell
	python3 -m venv venv

	#active the virtualenv
	source venv/bin/activate

	#Install the dependencies
	pip install -r requirements.txt
```
2. Generate an OSM query file for the region you want to study. 
	- Go to [openstreetmap.org](https://www.openstreetmap.org), search for the region you want to download (i.e. "Victoria"), then find the matching region in the list on the left side. 
	- Click on the region you want, which should open a page for a `relation` that says something like "Relation: Victoria (2221062)" at the top. 		- Scroll down in the list of tags until you find `wikidata`, i.e. `wikidata:Q2132` for Victoria, Canada. 
	- In a terminal, run `build_query.py` with this key-value pair: run `python query/build_query.py victoria wikidata Q2132` to generate a file `victoria.query`.
3. Running the script to download the osm data and calclate the LTS for the given region run:
```shell
	# for first time run if you haven't downloaded the osm data
	python lts_osm/lts_osm.py --overpass-query-file query/toronto.query

	# It should have created output folder where all the files will be saved

	# for help on how to use the script you can run
	python lts_osm/lts_osm.py --help

	# It'll print how to use the script
	python lts_osm/lts_osm.py --help
	usage: lts_osm.py [-h] (--overpass-query-file OVERPASS_QUERY_FILE | --osm-file OSM_FILE) [--place PLACE | --bbox BBOX]

	Calculates the Level of Traffic Stress from Open Street Map data.

	options:
	-h, --help            show this help message and exit
	--overpass-query-file OVERPASS_QUERY_FILE
							Path to query file for downloading the osm data
	--osm-file OSM_FILE   Path to the downloaded osm file to calculate the level of stress for
	--place PLACE         Place name for OSM download. Example: --place "Toronto, Ontario" Defaults to Toronto, Ontario
	--bbox BBOX           Bounding box for OSM download as 'west,south,east,north' (lon,lat,lon,lat). Example: --bbox="-79.406989,43.631478,-79.357878,43.672342"
```
4. Plot the results with `lts_osm/lts_plot.py`
```shell
	# plot the results
	# suppl the lts csv files generated by lts_osm.py and the name of the city the plot is for
	python lts_osm/lts_plot.py --lts-csv-file output/lts/all_lts_toronto.csv --gdf-nodes-file output/lts/gdf_nodes_toronto.csv --city "Toronto"
```
